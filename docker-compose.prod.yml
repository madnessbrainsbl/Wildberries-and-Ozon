services:
  frontend:
    build:
      context: .
      args:
        - VITE_SUPABASE_URL=${VITE_SUPABASE_URL}
        - VITE_SUPABASE_ANON_KEY=${VITE_SUPABASE_ANON_KEY}
    expose:
      - "5173"
    environment:
      - NODE_ENV=production
    restart: always
    networks:
      - app-network

  bot-backend:
    build: 
      context: ./bot-backend
      dockerfile: Dockerfile.prod
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=production
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - SUPABASE_URL=${VITE_SUPABASE_URL}
      - SUPABASE_ANON_KEY=${VITE_SUPABASE_ANON_KEY}
      - MINIAPP_URL=https://teleshop.su/miniapp/5358ebd1-d90b-4c55-a0ff-f8840f8da283
      - PORT=3002
      - DISABLE_BROWSER=true
    restart: always
    networks:
      - app-network
    depends_on:
      - frontend

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - /etc/letsencrypt:/etc/letsencrypt:ro
      - /var/www/certbot:/var/www/certbot:ro
    restart: always
    networks:
      - app-network
    depends_on:
      - frontend
      - bot-backend

networks:
  app-network:
    driver: bridge
